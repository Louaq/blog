 

ä¸€ã€æœ¬æ–‡ä»‹ç»
------

æœ¬æ–‡ç»™å¤§å®¶å¸¦æ¥çš„æ”¹è¿›æœºåˆ¶æ˜¯**ACmixè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„æ”¹è¿›ç‰ˆæœ¬**ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œä¼ ç»Ÿ[å·ç§¯æ“ä½œ](https://so.csdn.net/so/search?q=%E5%8D%B7%E7%A7%AF%E6%93%8D%E4%BD%9C&spm=1001.2101.3001.7020)å’Œè‡ªæ³¨æ„åŠ›æ¨¡å—çš„å¤§éƒ¨åˆ†è®¡ç®—éƒ½å¯ä»¥é€šè¿‡1x1çš„å·ç§¯æ¥å®ç°ã€‚ACmixé¦–å…ˆä½¿ç”¨1x1å·ç§¯å¯¹è¾“å…¥ç‰¹å¾å›¾è¿›è¡ŒæŠ•å½±ï¼Œç”Ÿæˆä¸€ç»„ä¸­é—´ç‰¹å¾ï¼Œç„¶åæ ¹æ®ä¸åŒçš„èŒƒå¼ï¼Œå³è‡ªæ³¨æ„åŠ›å’Œå·ç§¯æ–¹å¼ï¼Œåˆ†åˆ«é‡ç”¨å’Œèšåˆè¿™äº›ä¸­é—´ç‰¹å¾ã€‚è¿™æ ·ï¼ŒACmixæ—¢èƒ½åˆ©ç”¨è‡ªæ³¨æ„åŠ›çš„å…¨å±€æ„ŸçŸ¥èƒ½åŠ›ï¼Œåˆèƒ½é€šè¿‡å·ç§¯æ•è·å±€éƒ¨ç‰¹å¾ï¼Œä»è€Œåœ¨ä¿æŒè¾ƒä½è®¡ç®—æˆæœ¬çš„åŒæ—¶ï¼Œæé«˜æ¨¡å‹çš„æ€§èƒ½ã€‚

![](https://img-blog.csdnimg.cn/direct/167eb262000f45bdb51b51b68225d600.png)

**æ¨èæŒ‡æ•°ï¼šâ­â­â­â­**

**æ¶¨ç‚¹æ•ˆæœï¼šâ­â­â­â­**

> **ä¸“æ ç›®å½•ï¼š**[YOLOv8æ”¹è¿›æœ‰æ•ˆç³»åˆ—ç›®å½• | åŒ…å«å·ç§¯ã€ä¸»å¹²ã€æ£€æµ‹å¤´ã€æ³¨æ„åŠ›æœºåˆ¶ã€Neckä¸Šç™¾ç§åˆ›æ–°æœºåˆ¶](https://snu77.blog.csdn.net/article/details/135309007 "YOLOv8æ”¹è¿›æœ‰æ•ˆç³»åˆ—ç›®å½• | åŒ…å«å·ç§¯ã€ä¸»å¹²ã€æ£€æµ‹å¤´ã€æ³¨æ„åŠ›æœºåˆ¶ã€Neckä¸Šç™¾ç§åˆ›æ–°æœºåˆ¶")****

> **ä¸“æ å›é¡¾ï¼š******************************[YOLOv8æ”¹è¿›ç³»åˆ—ä¸“æ â€”â€”æœ¬ä¸“æ æŒç»­å¤ä¹ å„ç§é¡¶ä¼šå†…å®¹â€”â€”ç§‘ç ”å¿…å¤‡](https://blog.csdn.net/java1314777/category_12483754.html "YOLOv8æ”¹è¿›ç³»åˆ—ä¸“æ â€”â€”æœ¬ä¸“æ æŒç»­å¤ä¹ å„ç§é¡¶ä¼šå†…å®¹â€”â€”ç§‘ç ”å¿…å¤‡")********************************Â Â Â Â 

**ç›®å½•**

**[ä¸€ã€æœ¬æ–‡ä»‹ç»](#t1)**

**[äºŒã€ACmixçš„æ¡†æ¶åŸç†](#t2)**

**[2.1 ACMixçš„åŸºæœ¬åŸç†](#t3)**Â 

**[2.1.1 è‡ªæ³¨æ„åŠ›å’Œå·ç§¯çš„æ•´åˆ](#t4)**

**[2.1.2 è¿ç®—åˆ†è§£ä¸é‡æ„](#t5)**

**[ä¸‰ã€ACmixçš„æ ¸å¿ƒä»£ç ](#t6)**Â 

**[å››ã€æ‰‹æŠŠæ‰‹æ•™ä½ æ·»åŠ ACmix](#t7)**

**[4.1Â ACmixæ·»åŠ æ­¥éª¤](#t8)**

**[4.1.1 æ­¥éª¤ä¸€](#t9)**

**[4.1.2 æ­¥éª¤äºŒ](#t10)**

**[4.1.3 æ­¥éª¤ä¸‰](#t11)**

**[äº”ã€ACmixçš„yamlæ–‡ä»¶å’Œè¿è¡Œè®°å½•](#t12)**

**[5.1 ACMixçš„yamlç‰ˆæœ¬ä¸€(æ¨è)](#t13)**

**[4.2.2 ACMixçš„yamlç‰ˆæœ¬äºŒ](#t14)**

**[4.3 æ¨èACMixå¯æ·»åŠ çš„ä½ç½®](#t15)**Â 

**[4.4 ACMixçš„è®­ç»ƒè¿‡ç¨‹æˆªå›¾](#t16)**Â 

**[äº”ã€æœ¬æ–‡æ€»ç»“](#t17)**

* * *

äºŒã€ACmixçš„æ¡†æ¶åŸç†
------------

![](https://img-blog.csdnimg.cn/direct/1cd720f037a845839d099c18a23befb0.png)â€‹
-----------------------------------------------------------------------------

**å®˜æ–¹è®ºæ–‡åœ°å€ï¼š[å®˜æ–¹è®ºæ–‡åœ°å€](https://arxiv.org/pdf/2111.14556v1.pdf "å®˜æ–¹è®ºæ–‡åœ°å€")**

**å®˜æ–¹ä»£ç åœ°å€ï¼š[å®˜æ–¹ä»£ç åœ°å€](https://github.com/LeapLabTHU/ACmix/blob/main/ResNet/test_bottleneck.py "å®˜æ–¹ä»£ç åœ°å€")**

![](https://img-blog.csdnimg.cn/direct/5b7baaf109cd4eb490a36c2ccec1c7e0.png)â€‹

* * *

### 2.1 ACMixçš„åŸºæœ¬åŸç†Â 

ACmixæ˜¯ä¸€ç§æ··åˆæ¨¡å‹ï¼Œç»“åˆäº†[è‡ªæ³¨æ„åŠ›æœºåˆ¶](https://so.csdn.net/so/search?q=%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6&spm=1001.2101.3001.7020)å’Œå·ç§¯è¿ç®—çš„ä¼˜åŠ¿ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œä¼ ç»Ÿå·ç§¯æ“ä½œå’Œè‡ªæ³¨æ„åŠ›æ¨¡å—çš„å¤§éƒ¨åˆ†è®¡ç®—éƒ½å¯ä»¥é€šè¿‡1x1çš„å·ç§¯æ¥å®ç°ã€‚ACmixé¦–å…ˆä½¿ç”¨1x1å·ç§¯å¯¹è¾“å…¥ç‰¹å¾å›¾è¿›è¡ŒæŠ•å½±ï¼Œç”Ÿæˆä¸€ç»„ä¸­é—´ç‰¹å¾ï¼Œç„¶åæ ¹æ®ä¸åŒçš„èŒƒå¼ï¼Œå³è‡ªæ³¨æ„åŠ›å’Œå·ç§¯æ–¹å¼ï¼Œåˆ†åˆ«é‡ç”¨å’Œèšåˆè¿™äº›ä¸­é—´ç‰¹å¾ã€‚è¿™æ ·ï¼ŒACmixæ—¢èƒ½åˆ©ç”¨è‡ªæ³¨æ„åŠ›çš„å…¨å±€æ„ŸçŸ¥èƒ½åŠ›ï¼Œåˆèƒ½é€šè¿‡å·ç§¯æ•è·å±€éƒ¨ç‰¹å¾ï¼Œä»è€Œåœ¨ä¿æŒè¾ƒä½è®¡ç®—æˆæœ¬çš„åŒæ—¶ï¼Œæé«˜æ¨¡å‹çš„æ€§èƒ½ã€‚

**ACmixæ¨¡å‹çš„ä¸»è¦æ”¹è¿›æœºåˆ¶å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç‚¹ï¼š**

1\. è‡ªæ³¨æ„åŠ›å’Œå·ç§¯çš„æ•´åˆï¼šå°†è‡ªæ³¨æ„åŠ›å’Œå·ç§¯æŠ€æœ¯èåˆï¼Œå®ç°ä¸¤è€…ä¼˜åŠ¿çš„ç»“åˆã€‚  
2\. è¿ç®—åˆ†è§£ä¸é‡æ„ï¼šé€šè¿‡åˆ†è§£è‡ªæ³¨æ„åŠ›å’Œå·ç§¯ä¸­çš„è¿ç®—ï¼Œé‡æ„ä¸º1Ã—1å·ç§¯å½¢å¼ï¼Œæé«˜äº†è¿ç®—æ•ˆç‡ã€‚

* * *

#### 2.1.1 è‡ªæ³¨æ„åŠ›å’Œå·ç§¯çš„æ•´åˆ

æ–‡ç« ä¸­æŒ‡å‡ºï¼Œè‡ªæ³¨æ„åŠ›å’Œå·ç§¯çš„æ•´åˆé€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

**ç‰¹å¾åˆ†è§£ï¼š**è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„æŸ¥è¯¢ï¼ˆqueryï¼‰ã€é”®ï¼ˆkeyï¼‰ã€å€¼ï¼ˆvalueï¼‰ä¸å·ç§¯æ“ä½œé€šè¿‡1x1å·ç§¯è¿›è¡Œç‰¹å¾åˆ†è§£ã€‚  
**è¿ç®—å…±äº«ï¼š**å·ç§¯å’Œè‡ªæ³¨æ„åŠ›å…±äº«ç›¸åŒçš„1x1å·ç§¯è¿ç®—ï¼Œå‡å°‘äº†é‡å¤çš„è®¡ç®—é‡ã€‚  
**ç‰¹å¾èåˆï¼š**åœ¨ACmixæ¨¡å‹ä¸­ï¼Œå·ç§¯å’Œè‡ªæ³¨æ„åŠ›ç”Ÿæˆçš„ç‰¹å¾é€šè¿‡æ±‚å’Œæ“ä½œè¿›è¡Œèåˆï¼ŒåŠ å¼ºäº†æ¨¡å‹çš„ç‰¹å¾æå–èƒ½åŠ›ã€‚  
**æ¨¡å—åŒ–è®¾è®¡ï¼š**é€šè¿‡æ¨¡å—åŒ–è®¾è®¡ï¼ŒACmixå¯ä»¥çµæ´»åœ°åµŒå…¥åˆ°ä¸åŒçš„ç½‘ç»œç»“æ„ä¸­ï¼Œå¢å¼ºç½‘ç»œçš„è¡¨å¾èƒ½åŠ›ã€‚

### ![](https://img-blog.csdnimg.cn/direct/b1c6a1925b2e4331ae8658f0540bcc9d.png)â€‹

è¿™å¼ å›¾ç‰‡å±•ç¤ºäº†ACmixä¸­çš„ä¸»è¦æ¦‚å¿µï¼Œå®ƒæ¯”è¾ƒäº†å·ç§¯ã€è‡ªæ³¨æ„åŠ›å’ŒACmixå„è‡ªçš„ç»“æ„å’Œè®¡ç®—å¤æ‚åº¦ã€‚å›¾ä¸­ï¼š

(a) å·ç§¯ï¼šå±•ç¤ºäº†æ ‡å‡†å·ç§¯æ“ä½œï¼ŒåŒ…å«ä¸€ä¸ª![K^2](https://latex.csdn.net/eq?K%5E2)çš„1x1å·ç§¯ï¼Œè¡¨ç¤ºå·ç§¯æ ¸å¤§å°å’Œå·ç§¯æ“ä½œçš„èšåˆã€‚

(b) è‡ªæ³¨æ„åŠ›ï¼šå±•ç¤ºäº†è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªå¤´éƒ¨çš„1x1å·ç§¯ï¼Œä»£è¡¨å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ä¸­æ¯ä¸ªå¤´éƒ¨çš„çº¿æ€§å˜æ¢ï¼Œä»¥åŠè‡ªæ³¨æ„åŠ›èšåˆã€‚

(c) ACmixï¼ˆæˆ‘ä»¬çš„æ–¹æ³•ï¼‰ï¼šç»“åˆäº†å·ç§¯å’Œè‡ªæ³¨æ„åŠ›èšåˆï¼Œå…¶ä¸­1x1å·ç§¯åœ¨ä¸¤è€…ä¹‹é—´å…±äº«ï¼Œæ—¨åœ¨å‡å°‘è®¡ç®—å¼€é”€å¹¶æ•´åˆè½»é‡çº§çš„èšåˆæ“ä½œã€‚

æ•´ä½“ä¸Šï¼ŒACmixæ—¨åœ¨é€šè¿‡å…±äº«è®¡ç®—èµ„æºï¼ˆ1x1å·ç§¯ï¼‰å¹¶ç»“åˆä¸¤ç§ä¸åŒçš„èšåˆæ“ä½œï¼Œä»¥ä¼˜åŒ–ç‰¹å¾é€šé“ä¸Šçš„è®¡ç®—å¤æ‚åº¦ã€‚

* * *

#### 2.1.2 è¿ç®—åˆ†è§£ä¸é‡æ„

åœ¨ACmixä¸­ï¼Œè¿ç®—åˆ†è§£ä¸é‡æ„çš„æ¦‚å¿µæ˜¯æŒ‡å°†ä¼ ç»Ÿçš„å·ç§¯è¿ç®—å’Œè‡ªæ³¨æ„åŠ›è¿ç®—æ‹†åˆ†ï¼Œå¹¶é‡æ–°æ„å»ºä¸ºæ›´é«˜æ•ˆçš„å½¢å¼ã€‚è¿™ä¸»è¦é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ï¼š

**åˆ†è§£å·ç§¯å’Œè‡ªæ³¨æ„åŠ›ï¼š**å°†æ ‡å‡†çš„å·ç§¯æ ¸åˆ†è§£æˆå¤šä¸ª1Ã—1å·ç§¯æ ¸ï¼Œæ¯ä¸ªæ ¸å¤„ç†ä¸åŒçš„ç‰¹å¾å­é›†ï¼ŒåŒæ—¶å°†è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­çš„æŸ¥è¯¢ï¼ˆqueryï¼‰ã€é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰çš„ç”Ÿæˆä¹Ÿè½¬æ¢ä¸º1Ã—1å·ç§¯æ“ä½œã€‚  
**é‡æ„ä¸ºæ··åˆæ¨¡å—ï¼š**å°†åˆ†è§£åçš„å·ç§¯å’Œè‡ªæ³¨æ„åŠ›è¿ç®—é‡æ„æˆä¸€ä¸ªç»Ÿä¸€çš„æ··åˆæ¨¡å—ï¼Œæ—¢åŒ…å«äº†å·ç§¯çš„ç©ºé—´ç‰¹å¾æå–èƒ½åŠ›ï¼Œä¹Ÿèå…¥äº†è‡ªæ³¨æ„åŠ›çš„å…¨å±€ä¿¡æ¯èšåˆåŠŸèƒ½ã€‚  
**æé«˜è¿ç®—æ•ˆç‡ï¼š**è¿™ç§åˆ†è§£ä¸é‡æ„çš„æ–¹æ³•å‡å°‘äº†å†—ä½™è®¡ç®—ï¼Œæé«˜äº†è¿ç®—æ•ˆç‡ï¼ŒåŒæ—¶é™ä½äº†æ¨¡å‹çš„å¤æ‚åº¦ã€‚

![](https://img-blog.csdnimg.cn/direct/d2a24c864b2d44c99085ce81d6d26228.png)â€‹

è¿™å¼ å›¾ç‰‡å±•ç¤ºäº†ACmixæå‡ºçš„æ··åˆæ¨¡å—çš„ç»“æ„ã€‚å›¾ç¤ºåŒ…å«äº†ï¼š

(a) å·ç§¯ï¼š3x3å·ç§¯é€šè¿‡1x1å·ç§¯çš„æ–¹å¼è¢«åˆ†è§£ï¼Œå±•ç¤ºäº†ç‰¹å¾å›¾çš„è½¬æ¢è¿‡ç¨‹ã€‚

(b)è‡ªæ³¨æ„åŠ›ï¼šè¾“å…¥ç‰¹å¾å…ˆè½¬æ¢æˆæŸ¥è¯¢ï¼ˆqueryï¼‰ã€é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰ï¼Œä½¿ç”¨1x1å·ç§¯å®ç°ï¼Œå¹¶é€šè¿‡ç›¸ä¼¼åº¦åŒ¹é…è®¡ç®—æ³¨æ„åŠ›æƒé‡ã€‚

(c) ACmixï¼šç»“åˆäº†(a)å’Œ(b)çš„ç‰¹ç‚¹ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µä½¿ç”¨ä¸‰ä¸ª1x1å·ç§¯å¯¹è¾“å…¥ç‰¹å¾å›¾è¿›è¡ŒæŠ•å½±ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µå°†ä¸¤ç§è·¯å¾„å¾—åˆ°çš„ç‰¹å¾ç›¸åŠ ï¼Œä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚

å³å›¾æ˜¾ç¤ºäº†ACmixæ¨¡å—çš„æµç¨‹ï¼Œå¼ºè°ƒäº†ä¸¤ç§æœºåˆ¶çš„èåˆå¹¶æä¾›äº†æ¯ä¸ªæ“ä½œå—çš„è®¡ç®—å¤æ‚åº¦ã€‚

* * *

ä¸‰ã€ACmixçš„æ ¸å¿ƒä»£ç Â 
-------------

è¯¥ä»£ç æœ¬èº«å­˜åœ¨ä¸€ä¸ªbugï¼Œä¼šå¯¼è‡´éªŒè¯çš„é€‚åˆæŠ¥ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ï¼Œæˆ‘å°†å…¶è¿›è¡Œäº†è§£å†³ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªè¯»è€…å’Œæˆ‘è¯´çš„æƒ³è¦å¸®å¿™è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜å›°æ‰°äº†ä»–å¾ˆä¹…ã€‚Â 

```cobol
import torchimport torch.nn as nn def position(H, W, type, is_cuda=True):    if is_cuda:        loc_w = torch.linspace(-1.0, 1.0, W).cuda().unsqueeze(0).repeat(H, 1).to(type)        loc_h = torch.linspace(-1.0, 1.0, H).cuda().unsqueeze(1).repeat(1, W).to(type)    else:        loc_w = torch.linspace(-1.0, 1.0, W).unsqueeze(0).repeat(H, 1)        loc_h = torch.linspace(-1.0, 1.0, H).unsqueeze(1).repeat(1, W)    loc = torch.cat([loc_w.unsqueeze(0), loc_h.unsqueeze(0)], 0).unsqueeze(0)    return loc  def stride(x, stride):    b, c, h, w = x.shape    return x[:, :, ::stride, ::stride]  def init_rate_half(tensor):    if tensor is not None:        tensor.data.fill_(0.5)  def init_rate_0(tensor):    if tensor is not None:        tensor.data.fill_(0.)  class ACmix(nn.Module):    def __init__(self, in_planes, out_planes, kernel_att=7, head=4, kernel_conv=3, stride=1, dilation=1):        super(ACmix, self).__init__()        self.in_planes = in_planes        self.out_planes = out_planes        self.head = head        self.kernel_att = kernel_att        self.kernel_conv = kernel_conv        self.stride = stride        self.dilation = dilation        self.rate1 = torch.nn.Parameter(torch.Tensor(1))        self.rate2 = torch.nn.Parameter(torch.Tensor(1))        self.head_dim = self.out_planes // self.head         self.conv1 = nn.Conv2d(in_planes, out_planes, kernel_size=1)        self.conv2 = nn.Conv2d(in_planes, out_planes, kernel_size=1)        self.conv3 = nn.Conv2d(in_planes, out_planes, kernel_size=1)        self.conv_p = nn.Conv2d(2, self.head_dim, kernel_size=1)         self.padding_att = (self.dilation * (self.kernel_att - 1) + 1) // 2        self.pad_att = torch.nn.ReflectionPad2d(self.padding_att)        self.unfold = nn.Unfold(kernel_size=self.kernel_att, padding=0, stride=self.stride)        self.softmax = torch.nn.Softmax(dim=1)         self.fc = nn.Conv2d(3 * self.head, self.kernel_conv * self.kernel_conv, kernel_size=1, bias=False)        self.dep_conv = nn.Conv2d(self.kernel_conv * self.kernel_conv * self.head_dim, out_planes,                                  kernel_size=self.kernel_conv, bias=True, groups=self.head_dim, padding=1,                                  stride=stride)         self.reset_parameters()     def reset_parameters(self):        init_rate_half(self.rate1)        init_rate_half(self.rate2)        kernel = torch.zeros(self.kernel_conv * self.kernel_conv, self.kernel_conv, self.kernel_conv)        for i in range(self.kernel_conv * self.kernel_conv):            kernel[i, i // self.kernel_conv, i % self.kernel_conv] = 1.        kernel = kernel.squeeze(0).repeat(self.out_planes, 1, 1, 1)        self.dep_conv.weight = nn.Parameter(data=kernel, requires_grad=True)        self.dep_conv.bias = init_rate_0(self.dep_conv.bias)     def forward(self, x):        q, k, v = self.conv1(x), self.conv2(x), self.conv3(x)        scaling = float(self.head_dim) ** -0.5        b, c, h, w = q.shape        h_out, w_out = h // self.stride, w // self.stride         # ### att        # ## positional encoding        pe = self.conv_p(position(h, w, x.dtype, x.is_cuda))         q_att = q.view(b * self.head, self.head_dim, h, w) * scaling        k_att = k.view(b * self.head, self.head_dim, h, w)        v_att = v.view(b * self.head, self.head_dim, h, w)         if self.stride > 1:            q_att = stride(q_att, self.stride)            q_pe = stride(pe, self.stride)        else:            q_pe = pe         unfold_k = self.unfold(self.pad_att(k_att)).view(b * self.head, self.head_dim,                                                         self.kernel_att * self.kernel_att, h_out,                                                         w_out)  # b*head, head_dim, k_att^2, h_out, w_out        unfold_rpe = self.unfold(self.pad_att(pe)).view(1, self.head_dim, self.kernel_att * self.kernel_att, h_out,                                                        w_out)  # 1, head_dim, k_att^2, h_out, w_out         att = (q_att.unsqueeze(2) * (unfold_k + q_pe.unsqueeze(2) - unfold_rpe)).sum(            1)  # (b*head, head_dim, 1, h_out, w_out) * (b*head, head_dim, k_att^2, h_out, w_out) -> (b*head, k_att^2, h_out, w_out)        att = self.softmax(att)         out_att = self.unfold(self.pad_att(v_att)).view(b * self.head, self.head_dim, self.kernel_att * self.kernel_att,                                                        h_out, w_out)        out_att = (att.unsqueeze(1) * out_att).sum(2).view(b, self.out_planes, h_out, w_out)         ## conv        f_all = self.fc(torch.cat(            [q.view(b, self.head, self.head_dim, h * w), k.view(b, self.head, self.head_dim, h * w),             v.view(b, self.head, self.head_dim, h * w)], 1))        f_conv = f_all.permute(0, 2, 1, 3).reshape(x.shape[0], -1, x.shape[-2], x.shape[-1])         out_conv = self.dep_conv(f_conv)         return self.rate1 * out_att + self.rate2 * out_conv  if __name__ == "__main__":     # Generating Sample image    image_size = (1, 24, 224, 224)    image = torch.rand(*image_size)     # Model    mobilenet_v1 = ACmix(24, 24)     out = mobilenet_v1(image)    print(out)
```

* * *

å››ã€æ‰‹æŠŠæ‰‹æ•™ä½ æ·»åŠ ACmix
--------------

### 4.1Â ACmixæ·»åŠ æ­¥éª¤

#### 4.1.1 æ­¥éª¤ä¸€

é¦–å…ˆæˆ‘ä»¬æ‰¾åˆ°å¦‚ä¸‹çš„ç›®å½•'ultralytics/nn/modules'ï¼Œç„¶ååœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªpyæ–‡ä»¶ï¼Œåå­—å¯ä»¥æ ¹æ®ä½ è‡ªå·±çš„ä¹ æƒ¯èµ·ï¼Œç„¶åå°†ACmixçš„æ ¸å¿ƒä»£ç å¤åˆ¶è¿›å»ã€‚

#### 4.1.2 æ­¥éª¤äºŒ

ä¹‹åæˆ‘ä»¬æ‰¾åˆ°'ultralytics/nn/tasks.py'æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ³¨å†Œæˆ‘ä»¬çš„ACmixæ¨¡å—ã€‚

é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨æ–‡ä»¶çš„å¼€å¤´å¯¼å…¥æˆ‘ä»¬çš„ACmixæ¨¡å—ï¼Œ**å¦‚ä¸‹å›¾æ‰€ç¤º->**

![](https://img-blog.csdnimg.cn/direct/67d5ff2b7628458c898186c8bd0c6f13.png)â€‹â€‹

#### 4.1.3 æ­¥éª¤ä¸‰

æˆ‘ä»¬æ‰¾åˆ°parse\_modelè¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æœç´¢ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨æ‰¾ï¼Œå¤§æ¦‚åœ¨å…­ç™¾å¤šè¡Œå§ã€‚Â æˆ‘ä»¬æ‰¾åˆ°å¦‚ä¸‹çš„åœ°æ–¹ï¼Œç„¶åå°†ACmixæ·»åŠ è¿›å»å³å¯ï¼Œæ¨¡ä»¿æˆ‘æ·»åŠ å³å¯ã€‚

![](https://img-blog.csdnimg.cn/direct/3ed44382dc244ff397522dd96dcb4746.png)â€‹â€‹

```cobol
        elif m in {ACmix}:            args = [ch[f],  ch[f]]
```

**åˆ°æ­¤æˆ‘ä»¬å°±æ³¨å†ŒæˆåŠŸäº†ï¼Œå¯ä»¥ä¿®æ”¹yamlæ–‡ä»¶ä¸­è¾“å…¥ACmixä½¿ç”¨è¿™ä¸ªæ¨¡å—äº†ã€‚**

* * *

äº”ã€ACmixçš„yamlæ–‡ä»¶å’Œè¿è¡Œè®°å½•
-------------------

**ä¸‹é¢æ¨èå‡ ä¸ªç‰ˆæœ¬çš„yamlæ–‡ä»¶ç»™å¤§å®¶ï¼Œå¤§å®¶å¯ä»¥å¤åˆ¶è¿›è¡Œè®­ç»ƒï¼Œä½†æ˜¯ç»„åˆç”¨å¾ˆå¤šå…·ä½“é‚£ç§æœ€æœ‰æ•ˆæœéƒ½ä¸ä¸€å®šï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®é›†æ•ˆæœä¹Ÿä¸ä¸€æ ·ï¼Œæˆ‘ä¸å¯æ¯ä¸€ç§éƒ½åšå®éªŒï¼Œæ‰€ä»¥æˆ‘ä¸‹é¢æ¨èäº†å‡ ç§æˆ‘è‡ªå·±è®¤ä¸ºå¯èƒ½æœ‰æ•ˆæœçš„é…åˆæ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±è¿›è¡Œç»„åˆã€‚**

* * *

### 5.1 ACMixçš„yamlç‰ˆæœ¬ä¸€(æ¨è)

ä¸‹é¢çš„æ·»åŠ ACMixæ˜¯æˆ‘å®éªŒç»“æœçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»…åœ¨å¤§ç›®æ ‡æ£€æµ‹å±‚çš„è¾“å‡ºæ·»åŠ äº†ä¸€ä¸ªACMixæ¨¡å—ï¼Œå°±æ¶¨ç‚¹äº†0.05å·¦å³ï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥åœ¨ä¸­ç­‰å’Œå°ç›®æ ‡æ£€æµ‹å±‚éƒ½æ·»åŠ ACMixæ¨¡å—è¿›è¡Œå°è¯•ï¼Œä¸‹é¢çš„yamlæ–‡ä»¶æˆ‘ä¼šç»™å¤§å®¶æ¨èã€‚

```cobol
# Ultralytics YOLO ğŸš€, AGPL-3.0 license# YOLOv8 object detection model with P3-P5 outputs. For Usage examples see https://docs.ultralytics.com/tasks/detect # Parametersnc: 80  # number of classesscales: # model compound scaling constants, i.e. 'model=yolov8n.yaml' will call yolov8.yaml with scale 'n'  # [depth, width, max_channels]  n: [0.33, 0.25, 1024]  # YOLOv8n summary: 225 layers,  3157200 parameters,  3157184 gradients,   8.9 GFLOPs  s: [0.33, 0.50, 1024]  # YOLOv8s summary: 225 layers, 11166560 parameters, 11166544 gradients,  28.8 GFLOPs  m: [0.67, 0.75, 768]   # YOLOv8m summary: 295 layers, 25902640 parameters, 25902624 gradients,  79.3 GFLOPs  l: [1.00, 1.00, 512]   # YOLOv8l summary: 365 layers, 43691520 parameters, 43691504 gradients, 165.7 GFLOPs  x: [1.00, 1.25, 512]   # YOLOv8x summary: 365 layers, 68229648 parameters, 68229632 gradients, 258.5 GFLOP # YOLOv8.0n backbonebackbone:  # [from, repeats, module, args]  - [-1, 1, Conv, [64, 3, 2]]  # 0-P1/2  - [-1, 1, Conv, [128, 3, 2]]  # 1-P2/4  - [-1, 3, C2f, [128, True]]  - [-1, 1, Conv, [256, 3, 2]]  # 3-P3/8  - [-1, 6, C2f, [256, True]]  - [-1, 1, Conv, [512, 3, 2]]  # 5-P4/16  - [-1, 6, C2f, [512, True]]  - [-1, 1, Conv, [1024, 3, 2]]  # 7-P5/32  - [-1, 3, C2f, [1024, True]]  - [-1, 1, SPPF, [1024, 5]]  # 9 # YOLOv8.0n headhead:  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]  - [[-1, 6], 1, Concat, [1]]  # cat backbone P4  - [-1, 3, C2f, [512]]  # 12   - [-1, 1, nn.Upsample, [None, 2, 'nearest']]  - [[-1, 4], 1, Concat, [1]]  # cat backbone P3  - [-1, 3, C2f, [256]]  # 15 (P3/8-small)  - [-1, 1, ACmix, []]  # 16   - [-1, 1, Conv, [256, 3, 2]]  - [[-1, 12], 1, Concat, [1]]  # cat head P4  - [-1, 3, C2f, [512]]  # 19 (P4/16-medium)  - [-1, 1, ACmix, []]  # 20   - [-1, 1, Conv, [512, 3, 2]]  - [[-1, 9], 1, Concat, [1]]  # cat head P5  - [-1, 3, C2f, [1024]]  # 23 (P5/32-large)  - [-1, 1, ACmix, []]  # 24   - [[16, 20, 24], 1, Detect, [nc]]  # Detect(P3, P4, P5)
```

* * *

### 5.2 ACMixçš„yamlç‰ˆæœ¬äºŒ

**æ·»åŠ çš„ç‰ˆæœ¬äºŒå…·ä½“é‚£ç§é€‚åˆä½ éœ€è¦å¤§å®¶è‡ªå·±å¤šåšå®éªŒæ¥å°è¯•ã€‚**

```cobol
# Ultralytics YOLO ğŸš€, AGPL-3.0 license# YOLOv8 object detection model with P3-P5 outputs. For Usage examples see https://docs.ultralytics.com/tasks/detect # Parametersnc: 80  # number of classesscales: # model compound scaling constants, i.e. 'model=yolov8n.yaml' will call yolov8.yaml with scale 'n'  # [depth, width, max_channels]  n: [0.33, 0.25, 1024]  # YOLOv8n summary: 225 layers,  3157200 parameters,  3157184 gradients,   8.9 GFLOPs  s: [0.33, 0.50, 1024]  # YOLOv8s summary: 225 layers, 11166560 parameters, 11166544 gradients,  28.8 GFLOPs  m: [0.67, 0.75, 768]   # YOLOv8m summary: 295 layers, 25902640 parameters, 25902624 gradients,  79.3 GFLOPs  l: [1.00, 1.00, 512]   # YOLOv8l summary: 365 layers, 43691520 parameters, 43691504 gradients, 165.7 GFLOPs  x: [1.00, 1.25, 512]   # YOLOv8x summary: 365 layers, 68229648 parameters, 68229632 gradients, 258.5 GFLOP # YOLOv8.0n backbonebackbone:  # [from, repeats, module, args]  - [-1, 1, Conv, [64, 3, 2]]  # 0-P1/2  - [-1, 1, Conv, [128, 3, 2]]  # 1-P2/4  - [-1, 3, C2f, [128, True]]  - [-1, 1, Conv, [256, 3, 2]]  # 3-P3/8  - [-1, 6, C2f, [256, True]]  - [-1, 1, Conv, [512, 3, 2]]  # 5-P4/16  - [-1, 6, C2f, [512, True]]  - [-1, 1, Conv, [1024, 3, 2]]  # 7-P5/32  - [-1, 3, C2f, [1024, True]]  - [-1, 1, SPPF, [1024, 5]]  # 9 # YOLOv8.0n headhead:  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]  - [[-1, 6], 1, Concat, [1]]  # cat backbone P4  - [-1, 3, C2f, [512]]  # 12   - [-1, 1, nn.Upsample, [None, 2, 'nearest']]  - [[-1, 4], 1, Concat, [1]]  # cat backbone P3  - [-1, 3, C2f, [256]]  # 15 (P3/8-small)    - [-1, 1, Conv, [256, 3, 2]]  - [[-1, 12], 1, Concat, [1]]  # cat head P4  - [-1, 3, C2f, [512]]  # 18 (P4/16-medium)    - [-1, 1, Conv, [512, 3, 2]]  - [[-1, 9], 1, Concat, [1]]  # cat head P5  - [-1, 3, C2f, [1024]]  # 21 (P5/32-large)  - [-1, 1, ACmix, []]  # 22   - [[15, 18, 22], 1, Detect, [nc]]  # Detect(P3, P4, P5)
```

### 5.3 æ¨èACMixå¯æ·»åŠ çš„ä½ç½®Â 

ACMix**æ˜¯ä¸€ç§å³æ’å³ç”¨çš„å¯æ›¿æ¢å·ç§¯çš„æ¨¡å—ï¼Œ**å…¶å¯ä»¥æ·»åŠ çš„ä½ç½®æœ‰å¾ˆå¤šï¼Œæ·»åŠ çš„ä½ç½®ä¸åŒæ•ˆæœä¹Ÿä¸åŒï¼Œæ‰€ä»¥æˆ‘ä¸‹é¢æ¨èå‡ ä¸ªæ·»åŠ çš„ä½ï¼Œç½®å¤§å®¶å¯ä»¥è¿›è¡Œå‚è€ƒï¼Œå½“ç„¶ä¸ä¸€å®šè¦æŒ‰ç…§æˆ‘æ¨èçš„åœ°æ–¹æ·»åŠ ã€‚

> 1.  **æ®‹å·®è¿æ¥ä¸­**ï¼šåœ¨æ®‹å·®ç½‘ç»œçš„æ®‹å·®è¿æ¥ä¸­åŠ å…¥ACMix**ã€‚**
>     
> 2.  **Neckéƒ¨åˆ†**ï¼šYOLOv8çš„Neckéƒ¨åˆ†è´Ÿè´£ç‰¹å¾èåˆï¼Œè¿™é‡Œæ·»åŠ ACMixå¯ä»¥å¸®åŠ©æ¨¡å‹æ›´æœ‰æ•ˆåœ°èåˆä¸åŒå±‚æ¬¡çš„ç‰¹å¾**(yamlæ–‡ä»¶ä¸€å’ŒäºŒ)**ã€‚
>     
> 3.  **Backboneï¼š**å¯ä»¥æ›¿æ¢ä¸­å¹²ç½‘ç»œä¸­çš„å·ç§¯éƒ¨åˆ†
>     
> 4.  èƒ½æ·»åŠ çš„ä½ç½®å¾ˆå¤šï¼Œä¸€ç¯‡æ–‡ç« å¾ˆéš¾å…¨éƒ¨ä»‹ç»åˆ°ï¼ŒåæœŸæˆ‘ä¼šå‘æ–‡ä»¶é‡Œé¢é›†æˆä¸Šç™¾ç§çš„æ”¹è¿›æœºåˆ¶ï¼Œç„¶åè¿˜æœ‰è®¸å¤šèåˆæ¨¡å—ï¼Œç»™å¤§å®¶ã€‚
>     

* * *

### 5.4 ACMixçš„è®­ç»ƒè¿‡ç¨‹æˆªå›¾Â 

**ä¸‹é¢æ˜¯æ·»åŠ äº†ACMixçš„è®­ç»ƒæˆªå›¾ã€‚**

å¤§å®¶å¯ä»¥çœ‹ä¸‹é¢çš„è¿è¡Œç»“æœå’Œæ·»åŠ çš„ä½ç½®æ‰€ä»¥ä¸å­˜åœ¨æˆ‘å‘çš„ä»£ç ä¸å…¨æˆ–è€…è¿è¡Œä¸äº†çš„é—®é¢˜å¤§å®¶æœ‰é—®é¢˜ä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºè¯„è®ºæˆ‘çœ‹åˆ°éƒ½ä¼šä¸ºå¤§å®¶è§£ç­”(æˆ‘çŸ¥é“çš„)ã€‚

![](https://img-blog.csdnimg.cn/direct/5b939e09036e485c9586c30c73670766.png)â€‹â€‹

â€‹â€‹â€‹

* * *

äº”ã€æœ¬æ–‡æ€»ç»“
------

åˆ°æ­¤æœ¬æ–‡çš„æ­£å¼åˆ†äº«å†…å®¹å°±ç»“æŸäº†ï¼Œåœ¨è¿™é‡Œç»™å¤§å®¶æ¨èæˆ‘çš„YOLOv8æ”¹è¿›æœ‰æ•ˆæ¶¨ç‚¹ä¸“æ ï¼Œæœ¬ä¸“æ ç›®å‰ä¸ºæ–°å¼€çš„å¹³å‡è´¨é‡åˆ†98åˆ†ï¼ŒåæœŸæˆ‘ä¼šæ ¹æ®å„ç§æœ€æ–°çš„å‰æ²¿é¡¶ä¼šè¿›è¡Œè®ºæ–‡å¤ç°ï¼Œä¹Ÿä¼šå¯¹ä¸€äº›è€çš„æ”¹è¿›æœºåˆ¶è¿›è¡Œè¡¥å……ï¼Œ**ç›®å‰æœ¬ä¸“æ å…è´¹é˜…è¯»(æš‚æ—¶ï¼Œå¤§å®¶å°½æ—©å…³æ³¨ä¸è¿·è·¯~)**ï¼Œå¦‚æœå¤§å®¶è§‰å¾—æœ¬æ–‡å¸®åŠ©åˆ°ä½ äº†ï¼Œè®¢é˜…æœ¬ä¸“æ ï¼Œå…³æ³¨åç»­æ›´å¤šçš„æ›´æ–°~

> **ä¸“æ å›é¡¾ï¼š******************************[YOLOv8æ”¹è¿›ç³»åˆ—ä¸“æ â€”â€”æœ¬ä¸“æ æŒç»­å¤ä¹ å„ç§é¡¶ä¼šå†…å®¹â€”â€”ç§‘ç ”å¿…å¤‡](https://blog.csdn.net/java1314777/category_12483754.html "YOLOv8æ”¹è¿›ç³»åˆ—ä¸“æ â€”â€”æœ¬ä¸“æ æŒç»­å¤ä¹ å„ç§é¡¶ä¼šå†…å®¹â€”â€”ç§‘ç ”å¿…å¤‡")********************************

![](https://img-blog.csdnimg.cn/direct/bd80c2385d0548e9a87edc73f9261794.gif)â€‹â€‹â€‹

æ–‡ç« çŸ¥è¯†ç‚¹ä¸å®˜æ–¹çŸ¥è¯†æ¡£æ¡ˆåŒ¹é…ï¼Œå¯è¿›ä¸€æ­¥å­¦ä¹ ç›¸å…³çŸ¥è¯†

[OpenCVæŠ€èƒ½æ ‘](https://edu.csdn.net/skill/opencv/opencv-a181ede3b8c7487fbcc212796c27ce77?utm_source=csdn_ai_skill_tree_blog)[OpenCVä¸­çš„æ·±åº¦å­¦ä¹ ](https://edu.csdn.net/skill/opencv/opencv-a181ede3b8c7487fbcc212796c27ce77?utm_source=csdn_ai_skill_tree_blog)[å›¾åƒåˆ†ç±»](https://edu.csdn.net/skill/opencv/opencv-a181ede3b8c7487fbcc212796c27ce77?utm_source=csdn_ai_skill_tree_blog)26890 äººæ­£åœ¨ç³»ç»Ÿå­¦ä¹ ä¸­

![](https://img-blog.csdnimg.cn/2e7f14b9651748c9a17c305b24cffc4c.png)

è´­ä¹°ä¸“æ çš„è¯»è€…ï¼Œå¯åŠ QqåŠ äº¤æµç¾¤

![](https://g.csdnimg.cn/extension-box/1.1.6/image/qq.png) QQåç‰‡

![](https://g.csdnimg.cn/extension-box/1.1.6/image/ic_move.png)

æœ¬æ–‡è½¬è‡ª <https://snu77.blog.csdn.net/article/details/135239236>ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚